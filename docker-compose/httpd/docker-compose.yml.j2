version: '3'
services:
  httpd-registry:
    container_name: "httpd-registry"
    image: "httpd:2.4.58@sha256:ad01c94aa4ee2a03eba75c84c1e485f62d29d119792c4ed59e66c5b63ae5c91f"
    restart: always
    volumes:
      - uploads:/usr/local/apache2/htdocs/
      - "{{ compose_dest_basedir }}/httpd/httpd.conf:/usr/local/apache2/conf/httpd.conf:ro"
    ports:
      - 3344:80
    labels:
      com.centurylinklabs.watchtower.enable: true

  python-api-server:
    container_name: httpd-api
    image: "registry.mgrote.net/python-api-server:latest@sha256:8a43f0e0c5a779fa08e50a5197916f54ca72dbed5bf07273f075900030c5703a"
    restart: always
    ports:
      - "5040:5000"
    volumes:
      - uploads:/uploads
    environment:
      # FLASK_DEBUG: 1 # for debugging
      # FLASK_APP: app # for debugging
      MAX_CONTENT_LENGTH: 500
      UPLOAD_DIRECTORY: /uploads
      AUTH_TOKEN: "{{ lookup('keepass', 'httpd-api-server-token', 'password') }}"
      ENABLE_WEBSERVER: false
    labels:
      com.centurylinklabs.watchtower.enable: true

volumes:
  uploads:
