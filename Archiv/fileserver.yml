###############################################################################
# Vor dem Ausfuehren des Playbooks die Festplatten fuer
# mergerFS mit "/dev/disk/by-id" rausfinden.
# Die Festplatten werden unter sources hinterlegt.
# Auf diesen Festplatten muss sich ein EXT4_Dateisystem befinden.
# "mkfs.ext4 /dev/..."
###############################################################################
# Wenn es hier hakt, zuerst SMB auskommentieren, Ausfuehren dann wieder mit smb.
###############################################################################
# Wenn Freigaben geloescht werden muss der dazugehoerige Ordner per CLI geloescht
# werden.
###############################################################################

---
- hosts: fileserver.grote.lan
  roles:
    - { role: mgrote.fileserver_mergerfs, tags: "fileserver_mergerfs" }
    - { role: mgrote.postfix-gmail, tags: "postfix-gmail" }
    - { role: mgrote.fileserver_smb, tags: "fileserver_smb" }
    - { role: mgrote.sicherung_medien, tags: "youtube-dl", when: ansible_hostname  == "fileserver", become: true }
    - { role: mgrote.sicherung_nextcloud, tags: "nextcloud_sicherung", when: ansible_hostname  == "fileserver" }
    - { role: mgrote.sicherung_cloud, tags: "rclone", when: ansible_hostname  == "fileserver" }

  vars:
    ### mergerFS
    mergerfs_mountpoint: "/shares"
    mount_optionen: defaults,allow_other,direct_io,use_ino,moveonenospc=true,category.create=mfs,minfreespace=100G,nonempty
    ###laufwerke: sind im inventory pro host deklariert
    mergerfs_tree_cron_minutes: "30"
    mergerfs_tree_cron_hours: "5"
    ### smb_fileserver
    smb_nutzer:
      - { name: 'andreasgrote', groups: 'users', password: 'hallowelt' }
      - { name: 'annemariedroessler', groups: 'users', password: 'hallowelt' }
      - { name: 'aptcacherng', groups: 'users', password: 'hallowelt' }
      - { name: 'horstmartin', groups: 'users', password: 'hallowelt' }
      - { name: 'pve', groups: 'users', password: 'hallowelt' }
      - { name: 'restic', groups: 'users', password: 'restic' }
      - { name: 'toolserver', groups: 'users', password: 'hallowelt' }
      - { name: 'win10', groups: 'users', password: 'hallowelt' }
      - { name: 'toolserver', groups: 'users', password: '1TWoLbNzNG2W2c1rhyGh' }
      - { name: 'kodi', groups: 'users', password: 'hallowelt' }
      - { name: 'michaelgrote3', groups: 'users', password: 'hallowelt' }

    smb_freigaben: #werden unter /shares angelegt
      - { freigabename: 'Backup', ordnerpfad: '/shares/Backup', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'Musik', ordnerpfad: '/shares/Musik', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'Videos', ordnerpfad: '/shares/Videos', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'ag', ordnerpfad: '/shares/ag', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'amd', ordnerpfad: '/shares/amd', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'hm', ordnerpfad: '/shares/hm', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'mg', ordnerpfad: '/shares/mg', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'pve', ordnerpfad: '/shares/pve', lese_nutzer: '', schreibe_nutzer: '' }
      - { freigabename: 'tmp', ordnerpfad: '/shares/tmp', lese_nutzer: '', schreibe_nutzer: '' }
    smb_workgroup: WORKGROUP

    smb_nutzer_loeschen:
      - { name: 'platzhalter' }

    ### nfs_fileserver
    nfs_freigaben:
      - { freigabename: 'nfsfreigabe', nutzer: pve }

    ### youtube mg
    youtubedl_cron_minutes: "40"
    youtubedl_cron_hours: "21"
    playlisten:
      - { url: 'https://www.youtube.com/playlist?list=PLPM-eyPokAWNhhDNO4YzC5cGRwuI2ykwE', titel: 'music'}
      - { url: 'https://www.youtube.com/playlist?list=PLPM-eyPokAWNnDxuyX131R5wkl8fzvu7D', titel: 'lost and found'}
      - { url: 'https://www.youtube.com/playlist?list=PLPM-eyPokAWPmStfh37roJge-JuLfgma0', titel: 'lost and found 2'}
    ### nextcloud_sicherung
    nextcloud_sicherung_cron_minutes: "20"
    nextcloud_sicherung_cron_hours: "21"
    ### rclone
    rclone_cron_minutes: "1"
    rclone_cron_hours: "22,04,10,16"
    ### postfix
    mail_nach_cronjob: false
