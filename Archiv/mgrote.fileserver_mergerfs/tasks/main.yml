  - name: mergerFS installieren
    become: yes
    apt:
      name:
        - mergerfs
        - python3
        - fuse
      state: present

  - name: mergerFS-Tools installieren
    become: yes
    git:
      repo: https://github.com/trapexit/mergerfs-tools.git
      dest: /usr/local/bin/mergerfs_tools
      version: 2.29.0

  - name: "einzelne Laufwerke mounten"
    become: yes
    mount:
      path: /mnt/{{ item.ordner }}
      src: "{{ item.pfad }}"
      fstype: ext4
      state: mounted
    loop: "{{ laufwerke }}"

  - name: "Mount mergerFS"
    become: yes
    mount:
      path: "{{ mergerfs_mountpoint }}"
      src: "/mnt/HDD*"
      opts: "{{ mount_optionen }}"
      fstype: fuse.mergerfs
      state: present

  - name: Ordner "tree" erstellen
    become: yes
    file:
      path: /root/tree
      state: directory

  - name: Kopiere Tree-Script
    become: yes
    template:
      src: tree.sh
      dest: /root/tree/tree.sh
      mode: a+x

  - name: cronjob fuer tree.sh anlegen
    become: yes
    cron:
      name: tree
      state: present
      job: "/root/tree/tree.sh"
      minute: "{{ mergerfs_tree_cron_minutes }}"
      hour: "{{ mergerfs_tree_cron_hours }}"
