---
- name: ensure group exists
  become: true
  ansible.builtin.group:
    name: "{{ zfs_health_user_group }}"
    state: present
  when:
    - zfs_health_user_group is defined

- name: ensure user exists
  become: true
  ansible.builtin.user:
    name: "{{ zfs_health_user }}"
    group: "{{ zfs_health_user_group }}"
    shell: /usr/sbin/nologin
    create_home: false
  when:
    - zfs_health_user_group is defined
    - zfs_health_user is defined
