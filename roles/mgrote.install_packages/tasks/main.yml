  - name: apt update
    become: yes
    ansible.builtin.apt:
      update_cache: yes
      cache_valid_time: 300

  - name: install common-packages
    become: yes
    ansible.builtin.apt:
      name: "{{ programs_common }}"
      state: present

  - name: install extra-packages
    become: yes
    ansible.builtin.apt:
      name: "{{ programs_extra }}"
      state: present
    when:  programs_extra is defined

  - name: install vm-packages
    become: yes
    ansible.builtin.apt:
      name: "{{ programs_only_vms }}"
      state: present
    when: ansible_virtualization_role == 'guest'

  - name: install physical-packages
    become: yes
    ansible.builtin.apt:
      name: "{{ programs_only_physical }}"
      state: present
    when: ansible_virtualization_role != 'guest'

  - name: copy hddtemps.sh
    become: yes
    ansible.builtin.template:
      src: "hddtemps.sh"
      dest: "/usr/local/bin/hddtemps.sh"
      mode: a+x
    when: ansible_virtualization_role != 'guest'

  - name: copy systemtemps.sh
    become: yes
    ansible.builtin.template:
      src: "systemtemps.sh"
      dest: "/usr/local/bin/systemtemps.sh"
      mode: a+x
    when: ansible_virtualization_role != 'guest'
