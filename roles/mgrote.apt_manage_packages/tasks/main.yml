---
  - name: install common-packages
    become: yes
    ansible.builtin.package:
      name: "{{ apt_packages_common }}"
      state: present

  - name: install extra-packages
    become: yes
    ansible.builtin.package:
      name: "{{ apt_packages_extra }}"
      state: present
    when:  apt_packages_extra is defined

  - name: install vm-packages
    become: yes
    ansible.builtin.package:
      name: "{{ apt_packages_vm }}"
      state: present
    when: ansible_virtualization_role == 'guest'

  - name: install physical-packages
    become: yes
    ansible.builtin.package:
      name: "{{ apt_packages_physical }}"
      state: present
    when: ansible_virtualization_role != 'guest'

  - name: remove packages
    become: yes
    ansible.builtin.package:
      name: "{{ apt_packages_absent }}"
      state: absent
