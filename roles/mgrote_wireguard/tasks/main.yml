---
- name: Ensure package exists
  become: true
  ansible.builtin.package:
    name:
      - wireguard
    state: present

- name: Ensure resolvconf is configured
  become: true
  ansible.builtin.command: ln -s /usr/bin/resolvectl /usr/local/bin/resolvconf

- name: Ensure profiles are templated
  become: true
  ansible.builtin.template:
    src: "wg.conf.j2"
    dest: "{{ wireguard_conf_dir }}/{{ item.name }}.conf"
    owner: root
    group: root
    mode: "0600"
  when:
    - wireguard_profiles is defined
  loop: wireguard_profiles
...
