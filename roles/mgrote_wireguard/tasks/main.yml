---
- name: Ensure package exists
  become: true
  ansible.builtin.package:
    name:
      - wireguard
    state: present
  notify:
    - Ensure resolvconf is configured

- name: Ensure profiles are templated
  become: true
  ansible.builtin.template:
    src: "wg.conf.j2"
    dest: "{{ wireguard_conf_dir }}/{{ item.name }}.conf"
    owner: root
    group: root
    mode: "0600"
  when:
    - wireguard_profiles is defined
  loop: wireguard_profiles
...
