---
depends_on:
  - gitleaks
  - ansible-lint

skip_clone: true

steps:
  notify:
    name: notify
    image: registry.mgrote.net/allzweckcontainer:latest
    commands:
      - echo $CI_PREV_PIPELINE_URL # debug
      - echo $CI_PIPELINE_PARENT
      - echo $CI_PIPELINE_STATUS
      - |
        s-nail \
        -s "CI: [$CI_PREV_PIPELINE_STATUS] $CI_REPO ($CI_COMMIT_BRANCH)" \
        -S mta=smtp://docker10.mgrote.net:1025 \
        -S smtp-auth=none \
        -S v15-compat \
        -S from=ci@mgrote.net \
        $CI_COMMIT_AUTHOR_EMAIL <<EOF
        Repository: $CI_REPO
        Commit: $CI_COMMIT_SHA
        URL: $CI_PREV_PIPELINE_URL
        Status: $CI_PREV_PIPELINE_STATUS
        EOF
    when:
      event: [push]

runs_on: [ success, failure ]
