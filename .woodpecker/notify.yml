---
depends_on:
  - gitleaks
  - ansible-lint

skip_clone: true

steps:
  notify:
    name: notify
    image: deblan/woodpecker-email
    settings:
      dsn: "smtp://docker10.mgrote.net:1025"
      from:
        address: "ci@mgrote.net"
        name: "woodpecker"
      recipients:
        - info@mgrote.net
      evaluate: "build.status == 'failure' or prev_pipeline.status == 'failure'"
      content:
        subject: "CI: [{{ prev_pipeline.status }}] {{ repo.full_name }} ({{ commit.branch }}"
        body: |
          {{ repo.full_name }}<br>
          {{ commit.sha }}<br>
          {{ pipeline.url }}<br>
          {{ step.status }}<br>
    when:
      event: [push]

runs_on: [ success, failure ]
