---
steps:
  gitleaks:
    image: zricethezav/gitleaks:latest
    commands:
      - gitleaks detect --no-git --verbose --source $CI_WORKSPACE
    when:
      event:
        exclude:
          - tag

  notify:
    name: notify
    image: drillster/drone-email
    settings:
      host: smtp.some-server.com
      username: foo
      password: bar
      from: drone@your-domain.com
    when:
      status:
        - failure
