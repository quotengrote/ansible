---
steps:
  gitleaks:
    image: zricethezav/gitleaks:latest
    commands:
      - gitleaks detect --no-git --verbose --source $CI_WORKSPACE
    when:
      event:
        exclude:
          - tag

  notify:
    name: notify
    image: drillster/drone-email
    settings:
      host: mail-relay
      from: ci@mgrote.net
      subject: "CI: Run failed! - $CI_REPO"
      body: |
        $CI_REPO
        $CI_REPO_DEFAULT_BRANCH
        $CI_COMMIT_SHA
        $CI_PIPELINE_NUMBER
        $CI_PIPELINE_URL
        $CI_WORKFLOW_NAME
        $CI_STEP_NAME
        $CI_STEP_STATUS
    when:
      status:
        - failure
