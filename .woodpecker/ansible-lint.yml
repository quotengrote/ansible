---
depends_on:
  - gitleaks
steps:
  ansible-lint:
    image: quay.io/ansible/creator-ee
    commands:
      - ansible-lint --version
      - echo $VAULT-PASS > ./vault-pass.yml # nach des Secret in Gro√üschreibung
      - ansible-galaxy install -r requirements.yml
      - ansible-lint --force-color --format pep8
    when:
      event:
        exclude:
          - tag
    secret: [vault-pass] #dieses Secret darf verwendet werden

  notify:
    name: notify
    image: drillster/drone-email
    settings:
      host: mail-relay
      from: ci@mgrote.net
      subject: "CI: Run failed! - $CI_REPO"
#      body: |
#        $CI_REPO
#        $CI_REPO_DEFAULT_BRANCH
#        $CI_COMMIT_SHA
#        $CI_PIPELINE_NUMBER
#        $CI_PIPELINE_URL
#        $CI_WORKFLOW_NAME
#        $CI_STEP_NAME
#        $CI_STEP_STATUS
    when:
      status:
        - failure
