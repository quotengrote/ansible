---
name: lint
on:
  push

jobs:
  clone:
    steps:
      - name: Check out repository
        uses: actions/checkout@v3

  gitleaks:
    container:
      image: zricethezav/gitleaks:latest
    steps:
      - run: ls -lah
      - name: gitleaks
        run: gitleaks detect --no-git --verbose --source $GITHUB_WORKSPACE

  ansible-lint:
    container:
      image: quay.io/ansible/creator-ee
      env:
        VAULT-PASS: ${{ secrets.vault_pass }} # Repo-Secret
    steps:
      - run: ansible-lint --version
      - run: echo $VAULT-PASS > ./vault-pass.yml # nach des Secret in Gro√üschreibung
      - run: ls -lah

      - run: ansible-galaxy install -r ./requirements.yml
      - run: ansible-lint --force-color --format pep8
